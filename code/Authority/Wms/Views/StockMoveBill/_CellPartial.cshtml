<script type="text/javascript">
    //判断是移出的货位还是移入的货位out为移出，in为移入
    var cellInOrOut;
    //加载仓库树形结构数据数据根据cType（in或者out）加载不同的树形结构的数据
    function loadData(cType, cellCode, pCode) {
        cellInOrOut = cType;
        $('#cellDetail').datagrid('loadData', { total: 0, rows: [] }); //清空库存列表
        $('#warehouseTree').tree({ url: '/Cell/GetMoveCellDetails/?inOrOut=' + cType + '&productCode=' + pCode }); //加载树形数据
        $('#warehouseTree').tree({
            onClick: function (node) {
                if (node) {
                    if (cType == "out") {
                        $('#cellDetail').datagrid('options').url = '/Storage/GetMoveStorgeDetails/?type=' + node.attributes + '&id=' + node.id + '&inOrOut=' + cType + '&productCode=' + pCode;
                    } else {
                        $('#cellDetail').datagrid('options').url = '/Storage/GetMoveInStorgeDetails/?type=' + node.attributes + '&id=' + node.id + '&cellCode=' + cellCode + '&productCode=' + pCode;
                    }

                    $('#cellDetail').datagrid('load');
                }
            }
        });
        //双击选择移入货位
        $('#warehouseTree').tree({
            onDblClick: function (node) {
                if (cellInOrOut == "in") {
                    if (node.attributes == "cell") {
                        $('#inCellCode').val(node.id);
                        $('#inCellName').val(node.text);
                        $('#cellData').dialog('close');
                    }
                }
            }
        });
    }

    //货位确定按钮参数为out时给移出货位的空间赋值，参数为in时给移入货位的空间赋值
    function cellSave() {
        var cellRow = $('#cellDetail').datagrid('getSelected');
        if (cellRow) {
            if (cellInOrOut == "out") {
                if (cellRow.IsWholePallet == 1)//是整托盘出库，禁用单位编码按钮
                {
                    $('#UnitDetailLinkButton').linkbutton('disable');
                    $('#realQuantity').attr('readonly', 'readonly');
                }
                else {
                    $('#UnitDetailLinkButton').linkbutton('enable');
                    $('#realQuantity').removeAttr('readonly');
                }
                $('#outCellCode').val(cellRow.CellCode);
                $('#outCellName').val(cellRow.CellName);
                $('#productCode').val(cellRow.ProductCode);
                $('#productName').val(cellRow.ProductName);
                $('#realQuantity').numberbox('setValue', cellRow.Quantity);
                $('#unitCode').val(cellRow.UnitCode);
                $('#unitName').val(cellRow.UnitName);
                $('#outStorageCode').val(cellRow.StorageCode);
                $('#cellData').dialog('close');
            }
            else {
                $('#inCellCode').val(cellRow.CellCode);
                $('#inCellName').val(cellRow.CellName);
                $('#inStorageCode').val(cellRow.StorageCode);
                $('#cellData').dialog('close');
            }
        } else {
            if (cellInOrOut == "out") {
                $.messager.alert(g_MsgBoxTitle, "请选择要移出的货位", "info");
            }
            else if (cellInOrOut == "in") {
                $.messager.alert(g_MsgBoxTitle, "请选择要移入的货位", "info");
            }
        }
    }

    //货位列表点击事件点击选中的行并将选中行的值赋给相应的控件
    $(function () {
        $('#cellDetail').datagrid({
            onDblClickRow: function () {
                cellSave();
            }
        })
    });

    //根据条件查询
    function productQueryClick() {
        $("#cellDetail").datagrid({
            url: '/Storage/FindDetail/?queryString=' + $('#productType').combogrid('getValue') + '&value=' + $('#productInfo').val()
        });
        $("#cellDetail").datagrid('reload');
    }
</script>
<div id="cellData" class="easyui-dialog" modal="true" style="width: 860px; height: 500px;
    padding: 1px 1px" closed="true" buttons="#dlg-cellDatabuttons" toolbar = "#btnQuery">
    <div class="easyui-layout" fit="true">
        <div id="sidebar" region="west" border="false" style="width: 220px; border-right-style: solid;
            border-right-width: 1px; border-right-color: #99BBE8;">
            <ul id="warehouseTree" class="easyui-tree" url=''>
            </ul>
        </div>
        <div id="main" region="center" fit="true" border="false" style="margin: 1px">            
            <table id="cellDetail" class="easyui-datagrid" fit="true" border="false" singleselect="true"
                pagination="true" pagesize="50" rownumbers="true">
                <thead>
                    <tr>
                        <th field="StorageCode" width="60" hidden="true">
                            储存编码
                        </th>
                        <th field="CellCode" width="80" hidden="true">
                            货位编码
                        </th>
                        <th field="CellName" width="80">
                            货位名称
                        </th>
                        <th field="ProductCode" width="60">
                            产品编码
                        </th>
                        <th field="ProductName" width="150">
                            产品名称
                        </th>
                        <th field="Quantity" width="50">
                            数量
                        </th>
                        <th field="UnitCode" width="60">
                            单位名称
                        </th>
                        <th field="UnitName" width="60">
                            单位名称
                        </th>
                        <th field="StorageTime" width="80">
                            入库时间
                        </th>
                        <th field="StorageSequence" width="40">
                            顺序
                        </th>
                        <th field="IsWholePallet" width="60" hidden="true">
                            是否整托盘
                        </th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>
<div id="btnQuery" style="margin-left: 5px;">
                <select id="productType" class="easyui-combobox" style="width: 100px;" readonly="true" panelheight="auto">
                    <option value="ProductCode">卷烟编码</option>
                    <option value="ProductName">卷烟名称</option>
                </select>
                <input id="productInfo" />
                <a href="#" class="easyui-linkbutton" iconcls="icon-search" plain="true" onclick="productQueryClick()"
                    id="productQuery">查询</a>
            </div>
<div id="dlg-cellDatabuttons">
    <a href="#" class="easyui-linkbutton" iconcls="icon-ok" onclick="cellSave()">确定</a>
    <a href="#" class="easyui-linkbutton" iconcls="icon-cancel" onclick="javascript:$('#cellData').dialog('close')">
        取消</a>
</div>

